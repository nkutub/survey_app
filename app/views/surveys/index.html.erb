<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Surveys</h1>
  <%# <%= link_to "New Survey", new_survey_path, class: "btn btn-primary" %>
</div>

<div class="mb-4">
  <%= render "form" %>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 flex-row align-items-start">
  <% if @surveys.any? %>
    <% @surveys.each do |survey| %>
      <div class="col">
        <div class="card survey-card" style="height: auto;">
          <div class="card-body">
            <div class="card-title">
              <%= simple_format(survey.question, class: "mb-0") %>
            </div>
          </div>
          
          <div class="card-footer bg-light border-bottom">
            <div class="row text-center">
              <div class="col">
                <div class="fw-bold"><%= survey.responses.count %></div>
                <small class="text-muted">Responses</small>
              </div>
              <div class="col border-start">
                <div class="fw-bold"><%= survey_formated_yes_percentage(survey) %></div>
                <small class="text-muted">Yes %</small>
              </div>
            </div>
          </div>
          
          <div class="card-footer bg-transparent">
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <%= survey_formated_created_at(survey) %>
              </small>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#responses-<%= survey.id %>" 
                        aria-expanded="false">
                  View Responses
                </button>
              </div>
            </div>
          </div>

          <%# Collapsible Responses Section %>
          <div class="collapse" id="responses-<%= survey.id %>">
            <div class="card-body border-top">
              <h6 class="mb-3">Recent Responses</h6>
              <% survey.responses.order(created_at: :desc).limit(10).each do |response| %>
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="badge <%= response.yes? ? 'bg-success' : 'bg-danger' %> me-2">
                    <%= response.answer.upcase %>
                  </span>
                  <small class="text-muted">
                    <%= response.created_at.strftime('%B %d, %Y at %I:%M %p') %>
                  </small>
                </div>
              <% end %>
              
              <% if survey.responses.count > 10 %>
                <div class="text-center mt-3">
                  <%= link_to "View All Responses", 
                      survey_path(survey), 
                      class: "btn btn-sm btn-outline-secondary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="col-12">
      <div class="alert alert-info text-center">
        No surveys found. Create your first survey above!
      </div>
    </div>
  <% end %>
</div>

<div class="d-flex justify-content-center mt-4">
  <%= paginate @surveys %>
</div>